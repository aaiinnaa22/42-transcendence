// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider    = "prisma-client-js"
}

/// Once ready to launch set the database location in the Docker container's environment
datasource db {
  provider    = "sqlite"
  url         = env("DATABASE_URL")
}

// User table containing user-related information
model User {
  id              String      @id @default(uuid())
  email           String?     @unique
  username        String?     @unique
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  lastLogin       DateTime?
  avatar          String?

  providers       Provider[]
  credential      Credential?
  playerStats     PlayerStats?
  
  // Friends relationships
  friendships     Friendship[] @relation("UserFriendships")
  friendOf        Friendship[] @relation("FriendFriendships")
}

// Authentication providers table (Google, GitHub, Facebook, etc)
model Provider {
  userId          String
  providerSource  String
  providerId      String

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([providerSource, providerId])
  @@index([userId])
}

// Table for local authentication of the user
model Credential {
  userId          String      @id
  password        String
  updatedAt       DateTime    @updatedAt

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// User's player statistics table
model PlayerStats {
  userId          String      @id
  wins            Int         @default(0)
  losses          Int         @default(0)
  playedGames     Int         @default(0)
  eloRating       Int         @default(1200)

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Friendship table for user relationships
model Friendship {
  id          String   @id @default(uuid())
  userId      String
  friendId    String
  status      String   @default("pending") // pending, accepted, blocked
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        User     @relation("UserFriendships", fields: [userId], references: [id], onDelete: Cascade)
  friend      User     @relation("FriendFriendships", fields: [friendId], references: [id], onDelete: Cascade)
  
  @@unique([userId, friendId])
  @@index([userId])
  @@index([friendId])
}
